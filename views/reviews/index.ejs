<% include ../partials/header %>

<div class="container mt-5">
  <div class="row">
    <div class="col-md-12">
      <h1 class="text-center py-5"><%= campground.name %> reviews</h1>
      <div class="card">
        <div class="card-body">
          <% if (campground.rating === 0) { %>
          <h5 class="card-title">
            <em>No reviews yet.</em>
          </h5>
          <% } else { %>
          <p class="card-title">
            <span class="fas fa-star checked-star"></span>
            <span class="fas fa-star <% if (campground.rating >= 1.5) { %> checked-star <% } %>"></span>
            <span class="fas fa-star <% if (campground.rating >= 2.5) { %> checked-star <% } %>"></span>
            <span class="fas fa-star <% if (campground.rating >= 3.5) { %> checked-star <% } %>"></span>
            <span class="fas fa-star <% if (campground.rating >= 4.5) { %> checked-star <% } %>"></span>
            <em>(total reviews: <%= campground.reviews.length %>)</em>
          </p>
          <p class="card-text">
            Current campground rating: <strong><%= campground.rating.toFixed(2) %></strong>
          </p>
          <h4 class="card-text mt-5">All reviews:</h4>
          <hr style="margin-top: 0;">
          <% campground.reviews.forEach(function(review){ %>
          <div class="row">
            <div class="col-md-3">
              <%- '<span class="fas fa-star checked-star"></span>'.repeat(review.rating)%><%- '<span class="fas fa-star"></span>'.repeat(5 - review.rating) %>
              <div class="card-text"><strong><%= review.author.username %></strong></div>
              <span class="card-text"><em><%= review.updatedAt.toDateString() %></em></span>
            </div>
            <div class="col-md-9">
              <p class="card-text" style="text-align: justify; word-wrap: break-word;">
                <%= review.text %>
              </p>
              <% if((currentUser && review.author.id.equals(currentUser._id)) || (currentUser && currentUser.isAdmin)){ %>
              <a class="btn btn-xs btn-warning"
                href="/campgrounds/<%=campground.id %>/reviews/<%=review.id %>/edit">Edit</a>
              <form id="delete-form" action="/campgrounds/<%=campground.id %>/reviews/<%=review.id %>?_method=DELETE"
                method="POST" class="d-inline">
                <input type="submit" class="btn btn-xs btn-danger" value="Delete">
              </form>
              <% } %>
            </div>
          </div>
          <hr>
          <% }); %>
          <% } %>
        </div>
      </div>
      <div class="text-center mt-5">
        <a href="/campgrounds/<%=campground.id%>/reviews/new"
          class="btn btn-custom btn-greenish-full d-block <% if(currentUser && campground.reviews.some(function(review){ return review.author.id.equals(currentUser.id) })) { %>disabled<% } %>">Write
          a New Review</a>
      </div>
      <div class="text-center my-3">
        <a href="/campgrounds/<%= campground.id %>"><i class="fas fa-arrow-left"></i> Go back</a>
      </div>
    </div>
  </div>
</div>

<% include ../partials/footer %>